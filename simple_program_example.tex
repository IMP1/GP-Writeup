\begin{figure}
\label{fig:simple_program}
\centering
\begin{tikzpicture}[scale=2, y=-1cm]

  \node (main_decl) [code, text width=9cm] at (0, 0) {main = init; Traverse!};
  \node (proc_decl) [code, text width=9cm] at (0, 0.3) {Traverse = \{add, reduce\}};
  
  \begin{scope}[yshift=-1cm]
    \node (rule_decl) [code, text width=9cm] at (0, 0) {init(x: list) = };
    \node (n1) [vertex, label=below:{1}, minimum size=1cm, mark_red] at (0, 0.6) {$x$};   
    \node (n2) [vertex, label=below:{1}, minimum size=1cm, mark_red] at (1, 0.6) {$x:0$};
    \draw[derivation] (n1) -> (n2);
  \end{scope}
  
  \begin{scope}[yshift=-2.8cm]
    \node (rule_decl) [code, text width=9cm] at (0, 0) {add(x,y: list; m,n: int) = };
    \node (n1) [vertex, label=below:{1}, minimum size=1cm, mark_violet] at (0, 0.6) {$x:m$};
    \node (n2) [vertex, label=below:{2}, minimum size=1cm] at (1, 0.6) {$y$};
    \path [edge] (n1) edge node[label=above:{n}] {} (n2);
    \node (lhs) [rule, fit={(n1) (n2)}] {};
  
    \node (n3) [vertex, label=below:{1}, minimum size=1cm, mark_violet] at (2, 0.6) {$x:m$};
    \node (n4) [vertex, label=below:{2}, minimum size=1cm, inner sep=0pt, mark_grey] at (3, 0.6) {\footnotesize $y:m+n$};
    \path [edge] (n3) edge node[label=above:{n}] {} (n4);
    \node (rhs) [rule, fit={(n3) (n4)}] {};
  
    \draw[derivation] (rhs) -> (lhs);
  \end{scope}
  
  \begin{scope}[yshift=-4.6cm]
    \node (rule_decl) [code, text width=9cm] at (0, 0) {reduce(x,y: list; m,n,p: int) = };
    \node (n1) [vertex, label=below:{1}, minimum size=1cm, mark_violet] at (0, 0.6) {$x:m$};
    \node (n2) [vertex, label=below:{2}, minimum size=1cm, mark_grey] at (1, 0.6) {$y:p$};
    \path [edge] (n1) edge node[label=above:{n}] {} (n2);
    \node (lhs) [rule, fit={(n1) (n2)}] {};
  
    \node (n3) [vertex, label=below:{1}, minimum size=1cm, mark_violet] at (2, 0.6) {$x:m$};
    \node (n4) [vertex, label=below:{2}, minimum size=1cm, inner sep=0pt, mark_grey] at (3, 0.6) {\footnotesize $y:m+n$};
    \path [edge] (n3) edge node[label=above:{n}] {} (n4);
    \node (rhs) [rule, fit={(n3) (n4)}] {};
  
    \draw[derivation] (rhs) -> (lhs);
    \node (rule_2_condition) [code] at (0, 1.6) {where m + n < p};
  \end{scope}

\end{tikzpicture}
\caption{Simple Dijkstra Program Example}
\end{figure}